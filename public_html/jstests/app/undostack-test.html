<!DOCTYPE HTML>
<html>
<head>
  <title>UndoStack test</title>
  <script src="../../js/strings.js"></script>
  <script src="../../js/testing.js"></script>
  <script src="../../js/circularqueue.js"></script>
  <script src="../../js/app/undoentry.js"></script>
  <script src="../../js/app/undostack.js"></script>
  <script>
    addTest(function hasEntryAtOffset() {
      var us = new UndoStack(99);
      assertEquals(false, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.REDO));

      us.save('w1', 'v1');
      assertEquals(false, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.REDO));

      us.save('w2', 'v2');
      assertEquals(true, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.REDO));

      assertEquals('w1', us.selectWorld(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(true, us.hasEntryAtOffset(UndoStack.REDO));

      us.save('w3', 'v3');
      us.save('w4', 'v4');
      assertEquals('w3', us.selectWorld(UndoStack.UNDO));
      assertEquals(true, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(true, us.hasEntryAtOffset(UndoStack.REDO));
      assertEquals('w4', us.selectWorld(UndoStack.REDO));
      assertEquals(true, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.REDO));
    });

    addTest(function overflowDropsEntries() {
      var us = new UndoStack(2);
      us.save('w1', 'v1');
      us.save('w2', 'v2');
      us.save('w3', 'v3');
      assertEquals(true, us.hasEntryAtOffset(UndoStack.UNDO));
      assertEquals('w2', us.selectWorld(UndoStack.UNDO));
      assertEquals(false, us.hasEntryAtOffset(UndoStack.UNDO));
    });
  </script>
</head>
<body onload="runTests()"></body>
</html>
